# Role: Senior Full-Stack Architect & Data Engineer

**Contexto:**
Estamos implementando o **Gr√°fico de Marcos do Desenvolvimento** no Educare+.
J√° possu√≠mos a tabela `journey_questions` (Micro-habilidades). Vamos criar os `official_milestones` (Marcos Oficiais).

**Mudan√ßa de Escopo:**
Para n√£o iniciarmos com o banco vazio, precisamos de um script de **"Auto-Preenchimento Inteligente"**.
O sistema deve tentar vincular automaticamente as perguntas existentes aos marcos oficiais baseando-se em **Coincid√™ncia de Idade e Dom√≠nio**, para que o Curador apenas refine depois.

---

## üîê 1. Seguran√ßa e Roles (Base)

1.  **Tabela `users`:** Garanta que existe a coluna `role`.
2.  **Seed:** Crie um usu√°rio `admin@educare.app` com role `'curator'`.
3.  **Middleware:** Crie `requireCuratorRole` para proteger as rotas de edi√ß√£o.

---

## üèóÔ∏è 2. Modelagem de Dados

### A. Tabela `official_milestones` (Marcos Oficiais)
* `id`, `title`, `category` (Motor, Cognitivo, etc), `target_month`, `source`.
* **Seed Data:** Insira os marcos oficiais da Caderneta da Crian√ßa (0-60 meses).

### B. Tabela `milestone_mappings` (O V√≠nculo)
* `id`, `official_milestone_id`, `journey_question_id`, `weight`.
* **Novo Campo:** `is_auto_generated` (Boolean, Default: false). *Para sabermos o que foi feito pelo rob√¥.*
* **Novo Campo:** `verified_by_curator` (Boolean, Default: false).

---

## ü§ñ 3. O "Auto-Linker" (Script de Migra√ß√£o Inteligente)

Crie um script ou endpoint de setup (`POST /api/admin/setup/auto-link`) que execute a seguinte l√≥gica heur√≠stica:

1.  **Para cada** Marco Oficial inserido (Ex: "Sustenta a Cabe√ßa" - Motor - 3 Meses):
    * Converta o m√™s em semanas (Ex: 3 meses = semanas 11 a 14).
    * Busque na tabela `journey_questions` todas as perguntas que:
        * Tenham o mesmo **Dom√≠nio** (Ex: `domain` = 'motor').
        * Estejam dentro da **Janela de Tempo** (+/- 4 semanas de toler√¢ncia).
    * **A√ß√£o:** Insira um registro na tabela `milestone_mappings` para cada match encontrado.
    * **Flag:** Marque `is_auto_generated = TRUE` e `verified_by_curator = FALSE`.

*Resultado:* O gr√°fico j√° nascer√° preenchido. O trabalho do curador ser√° apenas remover os excessos, em vez de criar tudo do zero.

---

## üõ†Ô∏è 4. API do Curador (Refinamento)

Endpoints para o humano corrigir o trabalho do rob√¥:

* **`GET /api/admin/mappings?verified=false`**: Lista as sugest√µes feitas pelo rob√¥ para aprova√ß√£o.
* **`POST /api/admin/mappings/{id}/verify`**: O curador confirma que o v√≠nculo est√° correto (muda `verified` para true).
* **`DELETE /api/admin/mappings/{id}`**: O curador remove um v√≠nculo incorreto feito pelo rob√¥.

---

## üßÆ 5. Motor de C√°lculo (Dashboard)

Rota: `GET /api/dashboard/milestones-chart`.
**L√≥gica Ajustada:**
* Considere **TODOS** os mapeamentos ativos (seja manual ou autom√°tico) para gerar o gr√°fico inicial. Isso garante que o usu√°rio final veja valor imediato, mesmo antes da curadoria fina.

**Resultado Esperado:**
C√≥digo completo focando no script de "Auto-Linker" para popular o banco rapidamente.