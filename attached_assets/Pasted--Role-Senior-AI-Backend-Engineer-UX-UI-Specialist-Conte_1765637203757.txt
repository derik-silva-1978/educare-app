# Role: Senior AI Backend Engineer & UX/UI Specialist

**Contexto do Projeto:**
Estamos realizando um upgrade cr√≠tico no **M√≥dulo de Curadoria de Marcos** do Educare+.
A vers√£o anterior, baseada em filtros r√≠gidos (tags/dom√≠nios), mostrou-se insuficiente e limitante.
Vamos substitu√≠-la por um **Motor de Ranqueamento Sem√¢ntico (AI Matchmaker)**.

**Diretriz Estrat√©gica ("No Discard Policy"):**
O sistema **N√ÉO DEVE** ocultar ou descartar perguntas automaticamente.
Todas as perguntas que estiverem na janela temporal do marco devem ser exibidas.
A fun√ß√£o da IA ser√° **ranquear e ordenar** essas perguntas por relev√¢ncia (0 a 5 estrelas), facilitando o trabalho do curador, mas mantendo todas as op√ß√µes dispon√≠veis.

---

## üèóÔ∏è 1. Arquitetura de Dados (Schema Evolution)

Precisamos de tabelas para suportar a persist√™ncia da intelig√™ncia e os novos dados descritivos dos marcos oficiais.

### A. Tabela `official_milestones` (Ajuste)
* **Adicionar Coluna:** `description` (TEXT).
    * *Finalidade:* Armazenar o texto descritivo oficial do Minist√©rio da Sa√∫de (ex: "O beb√™ deve sustentar a cabe√ßa em 45 graus quando de bru√ßos...").
* **A√ß√£o de Seed:** Atualize o script de *seed* para popular essas descri√ß√µes nos marcos existentes. Caso n√£o tenhamos o texto exato agora, gere descri√ß√µes plaus√≠veis baseadas no t√≠tulo para fins de desenvolvimento.

### B. Nova Tabela `milestone_candidate_scores` (Cache de Intelig√™ncia)
Crie esta tabela para evitar chamar a OpenAI repetidamente para o mesmo par (Marco/Pergunta) e permitir ordena√ß√£o r√°pida:
* `official_milestone_id`: FK.
* `journey_question_id`: FK.
* `relevance_score`: Integer (0 a 5).
* `ai_reasoning`: Text (Justificativa curta da IA).
* `updated_at`: Timestamp.

---

## üß† 2. O Novo Motor "Auto-Linker" (Backend Logic)

**‚ö†Ô∏è ATEN√á√ÉO:** Localize a fun√ß√£o/rota atual que faz o "auto-link" ou "sugest√£o de candidatas". **Remova** qualquer l√≥gica que filtre por `question.domain == milestone.category`.

Crie ou atualize o endpoint de processamento (`/api/admin/ai-matching`) com a seguinte l√≥gica sequencial:

1.  **Escopo Temporal (Abertura):** Para o Marco Oficial selecionado, busque **TODAS** as perguntas do app cuja `week` esteja dentro da janela de tempo (+/- 4 semanas). *Ignore completamente o dom√≠nio/tag da pergunta.*
2.  **Verifica√ß√£o de Cache:** Para cada pergunta, verifique se j√° existe nota na tabela `milestone_candidate_scores`. Se n√£o, chame a OpenAI.
3.  **Prompt da OpenAI (Classifica√ß√£o Sem√¢ntica):**
    > "Atue como um Pediatra Especialista em Desenvolvimento Infantil.
    > Analise se a 'Pergunta do App' serve como evid√™ncia/sinal de que a crian√ßa atingiu o 'Marco Oficial'.
    >
    > **Marco Oficial:** [T√≠tulo] - [Descri√ß√£o do MS].
    > **Pergunta do App:** [Texto da Pergunta].
    >
    > **Tarefa:** D√™ uma nota de 0 a 5.
    > 5 = Evid√™ncia Perfeita (A pergunta prova o marco).
    > 4 = Fortemente Relacionada.
    > 3 = Relacionada (Pode servir).
    > 0-2 = Baixa ou Nenhuma rela√ß√£o direta.
    >
    > Retorne JSON: `{ score: int, reason: string }`."

4.  **Persist√™ncia:** Salve o resultado no banco.
5.  **Regra de Auto-V√≠nculo (Opcional):** Se `score == 5`, crie automaticamente o registro na tabela final `milestone_mappings` com a flag `is_auto_generated = true`.

---

## üé® 3. Refinamento da Interface (Frontend - Transfer List)

Atualize o componente de curadoria para refletir essa intelig√™ncia visualmente:

### A. Cabe√ßalho do Marco (Contexto Cl√≠nico)
* Abaixo do T√≠tulo do Marco e da Badge de M√™s, adicione um par√°grafo (texto cinza/it√°lico) exibindo a nova **`description`**. Isso serve de "gabarito" para o curador.

### B. Coluna Esquerda ("Candidatas / Dispon√≠veis")
* **Ordena√ß√£o:** A lista deve vir ordenada estritamente por `relevance_score DESC`.
    * *Topo:* Perguntas com 5 e 4 estrelas.
    * *Fundo:* Perguntas com 0, 1 ou 2 estrelas.
* **Visualiza√ß√£o de Relev√¢ncia:**
    * Ao lado de cada pergunta, renderize as **Estrelas** (‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê) baseadas no score.
    * **Tooltip Inteligente:** Ao passar o mouse nas estrelas, mostre o texto do `ai_reasoning` (Ex: *"Alta correla√ß√£o: ambos falam sobre controle de pesco√ßo"*).
* **Tratamento Visual (No Discard):** Perguntas com score baixo (0-2) devem ter opacidade levemente reduzida (ex: `opacity: 0.6`) para reduzir ru√≠do visual, mas **DEVEM continuar clic√°veis e mov√≠veis**. O curador humano tem a palavra final.

### C. Coluna Direita ("Vinculadas")
* **√çcone de Automa√ß√£o:** Se a pergunta foi movida automaticamente pelo script (score 5), exiba um √≠cone de rob√¥ ü§ñ ou um highlight sutil para indicar que requer revis√£o humana.

---

## üß™ 4. Crit√©rios de Aceite (QA)

1.  **Teste de Dom√≠nio Cruzado:** Verifique se uma pergunta de dom√≠nio "Social" aparece como candidata para um marco "Cognitivo" (se estiver na mesma semana). Ela deve aparecer, provando que o filtro r√≠gido foi removido.
2.  **Teste de Ordena√ß√£o:** As perguntas mais relevantes est√£o no topo da lista esquerda?
3.  **Teste de Persist√™ncia:** Ao mover uma pergunta de 0 estrelas para a direita manualmente, o v√≠nculo √© salvo corretamente? (Deve ser SIM).

**Entreg√°vel:**
C√≥digo Backend refatorado (nova l√≥gica de busca + integra√ß√£o OpenAI) e Frontend atualizado com as melhorias de UX.